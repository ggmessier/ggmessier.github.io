---
layout: project
repository_url: https://github.com/ggmessier/frogs
use_math: true
---
# Audio

Of course, we want robot frogs to talk!

## Capturing Audio Clips

Audio clips are currently captured from YouTube, recorded using Screenflow and then exported in AIFF format.  At that point, they're loaded into Audacity, converted to mono and exported as header-less unsigned 8-bit PCM files at a sample rate of 44.1~kHz.  The pulse coded modulation (PCM) seems just to be the raw 8 bit sample values.

## Electronics

Sound is expressed in decibels which, of course, is just a ratio of relative powers.  The reference level chosen for audio is the 0.02~mPa (the pressure of air) so audio levels are given by $20\log_{10} A/0.02$, where $A$ is the pressure of the sound on your ears.  Generally, 10~dB is approximately as loud as someone breathing and 60~dB is as loud as a conversation.

Consider the 8~ohm, 800~mW SP-1605 speaker (Digikey Part: 433-1104-ND).  The speaker is rated to deliver 88~dB at 1~W (an extrapolated value since the speaker can't take 1~W) and let's assume we want a volume range from 50~dB to 68~dB.  That corresponds to a maximum and minimum power of

$$
\begin{array}{cc}
P_{\rm max} = 30 - 20 = 10~{\rm dBm} &
P_{\rm min} = 30 - 38 = -8~{\rm dBm}
\end{array}
$$

Assume a sinusoidal tone and that these powers are RMS so that the peak current through the speaker to get these power levels is $i = \sqrt{2P/R}$, where $R$ = 8~ohms.  This means the min and max currents are 50~mA and 6.3~mA to get the volume range we want.  The max output current sourced by the PIC 16x op-amp is 100~mA so this is within our range.  The peak voltage across with 8~ohm speaker will vary between 400~mV and 50.4~mV.  

Utilizing a non-inverting op-amp amplifier design, the positive op-amp input terminal will be connected internally in the PIC to the DAC output and the negative input  will be connected to a grounded resistor $R_1$ and a second variable resistor $R_f$ connected to the output terminal.  The output voltage is given by $V_o = (1+R_f/R_1)V_i$.  Note that the minimum gain of the amplifier is unity when $R_f$ = 0.

Assuming the 10-bit DAC is used, the maximum voltage value is $V_{DD}$.  Since our audio files only us the bottom 8 bits, the maximum peak to peak input voltage will be $V_DD \cdot 256/1024$ = 412~mV.  This will drop to a peak voltage of 206~mV once the signal travels through the DC blocking capacitor.

Since this voltage is greater than our minimum target voltage, a voltage in series with the speaker is required.  Assuming a minimum amplifier gain of unity, the series resistance is equal to

$$
R_s = 206/50.4 \cdot (8 - 8 \cdot 50.4/206) = 27\ \Omega
$$

which can be achieved using a standard 27~Ohm resistor (Digikey Part: S27HCT-ND).

We require a voltage gain that varies between unity and 8.  Assuming $R_1$ = 820~Ohm, $R_f$ needs to vary between 802~Ohm and $820 \cdot (8-1)$ = 5.74~kOhm which can be achieved with an 802~Ohm resistor (Digikey Part: CF14JT820RCT-ND) in series with a 4.7~kOhm potentiometer (Digikey Part: A105790-ND).

Finally, a blocking capacitor must be used to remove the DC offset of the signal generated by the op-amp.  This capacitor in series with the load resistance forms a high-pass filter with a 3~dB cutoff given by $f_c = 1/(2\pi R C)$.  For a 4~Hz cutoff frequency and load resistance of 35~Ohms, the required series capacitor is 1137~uF.  We can use a 1000~uF aluminum electrolytic capacitor (Digikey Part: 1189-1583-1-ND) since they seem to be available at a reasonable price.

